<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ˜éšŠç­è¡¨ | Connect & Warmth</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --fet-red: #E60012;
            --fet-dark-red: #B3000E;
            --fet-bg: #f8f8f8;
            --text-dark: #333333;
            --text-gray: #777777;
            
            --status-work-bg: #fff0f1;
            --status-work-text: #E60012;
            --status-off-bg: #eeeeee;
            --status-off-text: #999999;
            --status-leave-bg: #fff8e1;
            --status-leave-text: #f39c12;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--fet-bg);
            margin: 0;
            padding: 0;
            color: var(--text-dark);
            -webkit-font-smoothing: antialiased;
        }

        header {
            background: linear-gradient(135deg, var(--fet-red) 0%, var(--fet-dark-red) 100%);
            padding: 30px 20px 60px 20px;
            color: white;
            text-align: center;
            border-bottom-left-radius: 24px;
            border-bottom-right-radius: 24px;
            box-shadow: 0 4px 12px rgba(230, 0, 18, 0.3);
        }

        h1 { margin: 0; font-size: 1.6rem; font-weight: 700; letter-spacing: 1px; }
        .subtitle { margin-top: 8px; font-size: 0.95rem; opacity: 0.9; font-weight: 400; }

        .container {
            max-width: 800px;
            margin: -45px auto 40px auto;
            padding: 0 20px;
            position: relative;
            z-index: 10;
        }

        /* --- å…¬å‘Šæ¬„å€å¡Š --- */
        .announcement-card {
            background: white;
            border-left: 5px solid var(--fet-red);
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            animation: fadeIn 0.5s ease-in-out;
            display: none; /* é è¨­éš±è—ï¼ŒæŠ“åˆ°è³‡æ–™æ‰é¡¯ç¤º */
        }
        
        .announcement-icon {
            font-size: 1.5rem;
            margin-top: 2px;
        }

        .announcement-content h3 {
            margin: 0 0 5px 0;
            font-size: 1rem;
            color: var(--fet-red);
        }
        
        .announcement-content p {
            margin: 0;
            font-size: 0.95rem;
            color: #555;
            line-height: 1.5;
        }

        .control-panel {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.06);
            display: flex;
            flex-direction: column;
            gap: 15px;
            text-align: center;
        }

        .date-picker-group { display: flex; align-items: center; justify-content: center; gap: 10px; }
        label { font-weight: 500; color: var(--text-dark); }
        
        select {
            padding: 10px 16px;
            font-size: 1rem;
            border: 2px solid #eee;
            border-radius: 30px;
            background: white;
            outline: none;
            cursor: pointer;
            font-family: 'Noto Sans TC', sans-serif;
        }
        select:focus { border-color: var(--fet-red); }

        .stats-bar {
            display: flex; justify-content: space-around;
            border-top: 1px solid #f0f0f0; padding-top: 15px; margin-top: 5px;
        }
        .stat-item strong { display: block; font-size: 1.4rem; color: var(--fet-red); margin-bottom: 4px; }

        .dashboard-section { margin-top: 25px; }
        .section-header {
            display: flex; align-items: center; gap: 8px; margin-bottom: 12px;
            font-weight: 700; font-size: 1.1rem; padding-left: 5px;
        }
        .section-header::before {
            content: ''; display: block; width: 4px; height: 18px;
            background: var(--fet-red); border-radius: 2px;
        }
        .section-header.off-header::before { background: #ccc; }

        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 12px; }

        .staff-card {
            background: white; padding: 15px 10px; border-radius: 12px;
            text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.03);
            border: 1px solid transparent; position: relative;
        }
        .staff-name { font-size: 1rem; font-weight: 700; margin-bottom: 6px; color: var(--text-dark); }
        .staff-shift { font-size: 0.85rem; display: inline-block; padding: 4px 10px; border-radius: 20px; font-weight: 500; }

        .status-work { border-color: rgba(230, 0, 18, 0.1); }
        .status-work .staff-shift { background-color: var(--status-work-bg); color: var(--status-work-text); }
        .status-off { opacity: 0.65; background: #fafafa; }
        .status-off .staff-shift { background-color: var(--status-off-bg); color: var(--status-off-text); }
        .status-leave .staff-shift { background-color: var(--status-leave-bg); color: var(--status-leave-text); }

        footer { text-align: center; margin-top: 40px; padding-bottom: 20px; color: #aaa; font-size: 0.8rem; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<header>
    <h1>FE Team Schedule</h1>
    <p class="subtitle" id="greeting">åªæœ‰é å‚³ï¼Œæ²’æœ‰è·é›¢ã€‚å¤¥ä¼´å€‘ä»Šå¤©åŠ æ²¹ï¼</p>
</header>

<div class="container">
    
    <div class="announcement-card" id="announcement-board">
        <div class="announcement-icon">ğŸ“¢</div>
        <div class="announcement-content">
            <h3 id="announcement-title">è®€å–å…¬å‘Šä¸­...</h3>
            <p id="announcement-msg">æ­£åœ¨æ›´æ–°é›²ç«¯è³‡è¨Š...</p>
        </div>
    </div>

    <div class="control-panel">
        <div class="date-picker-group">
            <label for="dateSelect">ğŸ“… æŸ¥çœ‹æ—¥æœŸ</label>
            <select id="dateSelect" onchange="renderSchedule()"></select>
        </div>

        <div class="stats-bar">
            <div class="stat-item"><strong id="count-work">0</strong>å€¼ç­å¤¥ä¼´</div>
            <div class="stat-item" style="color:#999"><strong style="color:#999" id="count-off">0</strong>ä¼‘å‡å……é›»</div>
        </div>
    </div>

    <div class="dashboard-section">
        <div class="section-header">Work Together (å€¼ç­ä¸­)</div>
        <div class="card-grid" id="working-list"></div>
    </div>

    <div class="dashboard-section">
        <div class="section-header off-header" style="color: #888;">Off Duty (ä¼‘æ¯ä¸­)</div>
        <div class="card-grid" id="off-list"></div>
    </div>
</div>

<footer>
    <p>Â© 2024 Team Schedule System</p>
</footer>

<script>
    // -----------------------------------------------------------
    // è¨­å®šå€ï¼šæ‚¨çš„ Google è©¦ç®—è¡¨ CSV é€£çµå·²å¡«å…¥
    // -----------------------------------------------------------
    const googleSheetCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSrRD50gSTA6V3LCDzhd4h1dQ0bcMGQCKwtBYVcIg0M2JpEnRkFUNaGSZFL6FxrwYdCQStTq1zB1WTl/pub?output=csv";

    // --- 1. ç­è¡¨è³‡æ–™èˆ‡äººå“¡ (DATA) ---
    // ç›®å‰åƒ…å¡«å…¥ 12/7 ~ 12/9 ç‚ºç¯„ä¾‹
    const staffList = ["é¡Oè", "æ¥ŠOæ½”", "èŠOç”¯", "å¼µOæ¶µ", "é»ƒOç³", "é»ƒOå½¥", "é™³Oé›¯", "é»ƒOè‚²", "ä¼Oç¶­", "éƒ­Oé€¸", "é™³Oæ–‡"];
    const scheduleData = {
        "12/7": { "é¡Oè": "1400", "æ¥ŠOæ½”": "1400", "èŠOç”¯": "DO", "å¼µOæ¶µ": "DO", "é»ƒOç³": "1400", "é»ƒOå½¥": "DO", "é™³Oé›¯": "DO", "é»ƒOè‚²": "1400", "ä¼Oç¶­": "1400", "éƒ­Oé€¸": "DO", "é™³Oæ–‡": "DO" },
        "12/8": { "é¡Oè": "1400", "æ¥ŠOæ½”": "ç‰¹ä¼‘", "èŠOç”¯": "1400", "å¼µOæ¶µ": "1400", "é»ƒOç³": "ç‰¹ä¼‘", "é»ƒOå½¥": "1400", "é™³Oé›¯": "1400", "é»ƒOè‚²": "1400", "ä¼Oç¶­": "1400", "éƒ­Oé€¸": "K07", "é™³Oæ–‡": "K07" },
        "12/9": { "é¡Oè": "DO", "æ¥ŠOæ½”": "DO", "èŠOç”¯": "1400", "å¼µOæ¶µ": "1400", "é»ƒOç³": "DO", "é»ƒOå½¥": "1400", "é™³Oé›¯": "1400", "é»ƒOè‚²": "DO", "ä¼Oç¶­": "DO", "éƒ­Oé€¸": "K07", "é™³Oæ–‡": "K07" }
        // ... è‹¥æœ‰æ›´å¤šè³‡æ–™è«‹ä¾æ ¼å¼ç¹¼çºŒè²¼ä¸Š ...
    };

    // --- 2. æŠ“å– Google è©¦ç®—è¡¨å…¬å‘Š ---
    async function fetchAnnouncement() {
        try {
            // åŠ å…¥æ™‚é–“æˆ³è¨˜é¿å…ç€è¦½å™¨å¿«å–èˆŠè³‡æ–™
            const response = await fetch(googleSheetCSV + "&t=" + new Date().getTime());
            const data = await response.text();
            
            // è§£æ CSV
            const rows = data.split("\n");
            
            // ç¢ºä¿æœ‰è³‡æ–™æ‰è™•ç†
            if (rows.length > 0) {
                // è™•ç†å¯èƒ½å­˜åœ¨çš„ CSV é€—è™Ÿå•é¡Œ
                const rawLine = rows[0]; 
                
                // ç°¡å–®åˆ‡å‰²é‚è¼¯ï¼šå–ç¬¬ä¸€å€‹é€—è™Ÿå‰çš„å­—ç•¶æ¨™é¡Œï¼Œé€—è™Ÿå¾Œå…¨éƒ¨ç•¶å…§å®¹
                const firstCommaIndex = rawLine.indexOf(',');
                
                if (firstCommaIndex !== -1) {
                    let title = rawLine.substring(0, firstCommaIndex).trim();
                    let msg = rawLine.substring(firstCommaIndex + 1).trim();

                    // ç§»é™¤ CSV å¯èƒ½ç”¢ç”Ÿçš„é›™å¼•è™Ÿ
                    title = title.replace(/^"|"$/g, '');
                    msg = msg.replace(/^"|"$/g, '');

                    if (title && msg) {
                        const board = document.getElementById('announcement-board');
                        board.style.display = "flex"; // é¡¯ç¤ºå…¬å‘Šæ¬„
                        document.getElementById('announcement-title').textContent = title;
                        document.getElementById('announcement-msg').textContent = msg;
                    } else {
                        // å…§å®¹å¦‚æœæ˜¯ç©ºçš„ï¼Œå°±éš±è—
                        document.getElementById('announcement-board').style.display = "none";
                    }
                }
            }
        } catch (error) {
            console.error("å…¬å‘Šè®€å–å¤±æ•—:", error);
            // å¤±æ•—æ™‚éš±è—å…¬å‘Šæ¬„ï¼Œä¿æŒç•«é¢ä¹¾æ·¨
            document.getElementById('announcement-board').style.display = "none";
        }
    }

    // --- 3. æ¸²æŸ“ç­è¡¨ ---
    const dateSelect = document.getElementById('dateSelect');
    const workingList = document.getElementById('working-list');
    const offList = document.getElementById('off-list');
    const countWork = document.getElementById('count-work');
    const countOff = document.getElementById('count-off');

    // éš¨æ©Ÿå•å€™èª
    const greetings = [
        "åªæœ‰é å‚³ï¼Œæ²’æœ‰è·é›¢ã€‚å¤¥ä¼´å€‘ä»Šå¤©åŠ æ²¹ï¼",
        "ç”¨å¿ƒé€£çµæ¯ä¸€åˆ»ï¼Œä»Šå¤©ä¹Ÿè¦å……æ»¿æ´»åŠ›ï¼",
        "è¾›è‹¦äº†ï¼åˆ¥å¿˜äº†äº’ç›¸æ”¯æ´ï¼Œæˆ‘å€‘æ˜¯æœ€æ£’çš„åœ˜éšŠã€‚",
        "ä¿æŒå¾®ç¬‘ï¼Œå¥½äº‹æœƒç™¼ç”Ÿï¼Keep Going!",
        "ä»Šå¤©çš„åŠªåŠ›ï¼Œæ˜¯ç‚ºäº†é‡è¦‹æ›´å¥½çš„è‡ªå·±ã€‚"
    ];

    Object.keys(scheduleData).forEach(date => {
        const option = document.createElement('option');
        option.value = date; option.text = date;
        dateSelect.appendChild(option);
    });

    function renderSchedule() {
        const selectedDate = dateSelect.value;
        const todaysShift = scheduleData[selectedDate] || {};
        workingList.innerHTML = ''; offList.innerHTML = '';
        let workCount = 0; let offCount = 0;

        if (Object.keys(todaysShift).length === 0) {
            workingList.innerHTML = '<p style="color:#aaa;">æš«ç„¡è³‡æ–™</p>'; return;
        }

        staffList.forEach(name => {
            const shift = todaysShift[name] || "æœªçŸ¥";
            const isOff = ["DO", "ä¼‘", "ç‰¹ä¼‘", ""].includes(shift);
            const isLeave = shift === "ç‰¹ä¼‘";
            const card = document.createElement('div');
            let statusClass = isOff ? (isLeave ? 'status-leave' : 'status-off') : 'status-work';
            card.className = `staff-card ${statusClass}`;
            card.innerHTML = `<div class="staff-name">${name}</div><div class="staff-shift">${shift}</div>`;
            isOff ? (offList.appendChild(card), offCount++) : (workingList.appendChild(card), workCount++);
        });
        countWork.textContent = workCount; countOff.textContent = offCount;
        
        // éš¨æ©Ÿåˆ‡æ›å•å€™èª
        document.getElementById('greeting').textContent = greetings[Math.floor(Math.random() * greetings.length)];
    }

    renderSchedule();
    fetchAnnouncement(); // åŸ·è¡ŒæŠ“å–å…¬å‘Š

</script>
</body>
</html>